{% extends 'base.html' %}

{% block title %}Profile{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">

            <!-- Profile Display Card -->
            <div class="card shadow-sm p-4 mb-4 text-center">
                <div class="d-flex flex-column align-items-center">
                    {% if user.profile_image %}
                    <img id="profilePreview" src="{{ user.profile_image.url }}" alt="Profile Picture"
                        class="profile-img mb-3">
                    {% else %}
                    <img id="profilePreview" src="https://via.placeholder.com/150?text=Profile" alt="Profile Picture"
                        class="profile-img mb-3">
                    {% endif %}

                    <h4 class="mb-1">{{ user.get_full_name }}</h4>
                    <p class="text-muted mb-2">{{ user.email }}</p>

                    {% if user.about_me %}
                    <p class="text-center mb-3">{{ user.about_me }}</p>
                    {% endif %}

                    <button class="btn btn-primary mt-2" id="editProfileBtn">Edit Profile</button>
                </div>
            </div>

            <!-- Profile Edit Form (Initially Hidden) -->
            <div class="card shadow-sm p-4" id="editProfileForm" style="display:none;">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row g-3">
                        {% for field in form %}
                        <div class="col-12">
                            <label class="form-label">{{ field.label }}</label>

                            {% if field.name == 'profile_image' %}
                            <input type="file" name="{{ field.name }}" class="form-control"
                                onchange="previewImage(event)">
                            {% elif field.field.widget.input_type == 'textarea' %}
                            <textarea name="{{ field.name }}" class="form-control" rows="4"
                                placeholder="Write something...">{{ field.value }}</textarea>
                            {% else %}
                            <input type="{{ field.field.widget.input_type }}" name="{{ field.name }}"
                                value="{{ field.value|default_if_none:'' }}" class="form-control">
                            {% endif %}

                            {% if field.errors %}
                            <div class="text-danger mt-1">{{ field.errors|striptags }}</div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>

                    <div class="mt-4 text-center">
                        <button type="submit" class="btn btn-success btn-lg">Update Profile</button>
                    </div>
                </form>
            </div>


            <script>
                // Toggle edit form visibility
                document.getElementById('editProfileBtn').addEventListener('click', function () {
                    const formCard = document.getElementById('editProfileForm');
                    if (formCard.style.display === "none") {
                        formCard.style.display = "block";
                        this.textContent = "Hide Edit Form";
                    } else {
                        formCard.style.display = "none";
                        this.textContent = "Edit Profile";
                    }
                });

                // Profile picture live preview
                function previewImage(event) {
                    const output = document.getElementById('profilePreview');
                    output.src = URL.createObjectURL(event.target.files[0]);
                    output.onload = function () { URL.revokeObjectURL(output.src); }
                }
            </script>

            <style>
                /* Profile image styling */
                .profile-img {
                    width: 150px;
                    height: 150px;
                    object-fit: cover;
                    /* crop and scale to fit box */
                    border-radius: 50%;
                    /* circular */
                    border: 2px solid #ddd;
                    padding: 2px;
                    transition: transform 0.3s ease-in-out;
                }

                .profile-img:hover {
                    transform: scale(1.05);
                    cursor: pointer;
                }

                /* Card hover effect */
                .card:hover {
                    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
                    transition: 0.3s ease-in-out;
                }
            </style>
            {% endblock %}